<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Available Dogs</title>
    <meta name="description" content="List of SC Sheltie Rescue dogs available for adoption.">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" sizes="192x192" href="favicon-192x192.png">

    <link rel="stylesheet" href="css/app.20141002.css"> <!-- Cache Busting: Update the # when you update main.css -->
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>
  <body>
    <!--[if lte IE 8]>
    <div data-alert class="alert-box warning browsehappy-alert">
      You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.
      <a href="#" class="close">&times;</a>
    </div>
    <![endif]-->

    <div class="page-wrap">
      <div class="contain-to-grid sticky">
        <nav class="top-bar" data-topbar>
          <ul class="title-area">
            <!-- Title Area -->
            <li class="name">
              <h1 class="show-for-large-up"><a href="index.html">South Carolina Sheltie Rescue</a></h1>
              <h1 class="show-for-medium-down"><a href="index.html">SCSR</a></h1>
            </li>
            <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">
            <ul class="right">
              <li><a href="index.html">Home</a></li>
              <li class="has-dropdown"><a href="available_dogs.html">Adopt</a>
                <ul class="dropdown">
                  <li><a href="adoption_requirements.html">Adoption Requirements</a></li>
                  <li class="active"><a href="available_dogs.html">Adoptable Dogs</a></li>
                  <li><a href="apply_to_adopt.php">Adoption Application</a></li>
                  <li><a href="apply_to_foster.php">Fostering Application</a></li>
                </ul>
              </li>
              <li><a href="surrender.html">Surrender a Sheltie</a></li>
              <li><a href="help_and_advice.html">Help and Advice</a></li>
              <li><a href="events.html">Rescue Events</a></li>
            </ul>
          </section>
        </nav>
      </div>

      <div class="row">
        <div class="large-12 medium-12 small-12 columns">
          <main role="main" class="main-content">
            <h2 class="headline first">Available for Adoption</h2>
            <p>You can view our available dogs below or on our <a href="http://www.petfinder.com/pet-search?animal_type=&pet_breed=&pet_age=&pet_size=&specialNeeds=&declawedPets=&children=&status=&shelter_pet_id=&internal=&contact=&name=&shelter_id=SC92&sort=" target="_blank">Petfinder site</a>. If you are interested in adopting one of our rescue dogs, please complete and submit our <a href="apply_to_adopt.php">Adoption Application</a> form. If you have any questions feel free to <a href="mailto:amanda@southcarolinasheltierescue.com">email</a> us.</p>

            <div id="pets" class="clearfix"></div>
            <div id="spinner" class="loading_spinner"></div>

            <input id="btnMore" type="button" class="large button expand invisible" value="View More" />
          </main>
        </div>
      </div>
    </div>

    <footer class="main-footer">
      <section id="social-media" class="social-media">
        <a href="http://www.petfinder.com/pet-search?shelterid=SC92" target="_blank">
          <span class="icon-bone"></span><span class="visuallyhidden">Petfinder</span>
        </a>
        <a href="https://www.facebook.com/SouthCarolinaSheltieRescue" target="_blank">
          <span class="icon-facebook"></span><span class="visuallyhidden">Facebook</span>
        </a>
        <a href="https://twitter.com/scsheltierescue" target="_blank">
          <span class="icon-twitter"></span><span class="visuallyhidden">Twitter</span>
        </a>
      </section>
      <section id="address" class="address">
        <p class="no-margin-bottom">
          <span class="name">SC Sheltie Rescue</span><br/>
          <span class="po-box">P.O. Box 11414</span><br/>
          <span class="city-state-zip">Columbia, SC 29211</span><br/>
          <span class="tel"><a href="tel:+18039200644">803.920.0644</a></span>
        </p>
      </section>
      <section id="copyright" class="copyright">
        <small>&copy; <script>document.write(new Date().getFullYear())</script><noscript>2014</noscript> South Carolina Sheltie Rescue</small>
      </section>
    </footer>


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script>
      (function() {
        var currentOffset = 0,
          maxOffset = 25, //equals 'count' value from petfinder.php
          opts = {
            lines: 13, // The number of lines to draw
            length: 20, // The length of each line
            width: 10, // The line thickness
            radius: 30, // The radius of the inner circle
            corners: 1, // Corner roundness (0..1)
            rotate: 0, // The rotation offset
            direction: 1, // 1: clockwise, -1: counterclockwise
            color: '#000', // #rgb or #rrggbb or array of colors
            speed: 0.7, // Rounds per second
            trail: 25, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false, // Whether to use hardware acceleration
            className: 'spinner', // The CSS class to assign to the spinner
            zIndex: 2e9, // The z-index (defaults to 2000000000)
            top: 'auto', // Top position relative to parent in px
            left: 'auto' // Left position relative to parent in px
          },
        spinner_target = document.getElementById('spinner'),
        spinner = undefined;

        function spinnerStart($btnMore) {
          $btnMore.addClass("invisible");
          if(!spinner) {
            spinner = new Spinner(opts).spin(spinner_target);
          } else {
            spinner.spin(spinner_target);
          }
        }

        function spinnerStop() {
          $("#spinner").hide();
          spinner.stop();
        }

        function optionListItem(option, sex) {
          var listchild;
          switch (option.$t) {
            case "altered":
              if(sex === "M") {
                listchild = $('<span/>', {text: "Neutered: "});
              } else if(sex === "F") {
                listchild = $('<span/>', {text: "Spayed: "});
              } else {
                listchild = $('<span/>', {text: "Spayed/Neutered: "});
              }
              listchild.append($('<span/>', {class: "icon-checkmark"}));
              break;
            case "hasShots":
              listchild = $('<span/>', {text: "Shots Current: "});
              listchild.append($('<span/>', {class: "icon-checkmark"}));
              break;
            case "housebroken":
            case "housetrained":
              listchild = $('<span/>', {text: "Housebroken: "});
              listchild.append($('<span/>', {class: "icon-checkmark"}));
              break;
            case "noKids":
              listchild = $('<strong/>', {text: "No Kids"});
              break;
            case "noCats":
              listchild = $('<strong/>', {text: "No Cats"});
              break;
            case "noDogs":
              listchild = $('<strong/>', {text: "No Dogs"});
              break;
            default:
              listchild = null;
          };
          return listchild;
        }

        /**
          Call petfinder.php to get a list of available dogs.
          Next, append the data to the HTML document.
         */
        function getPets() {
          var $btnMore = $("#btnMore"),
            url = "petfinder.php",
            data = {
              offset: currentOffset
            };

          // Retrieve the data
          spinnerStart($btnMore);
          $.getJSON(url, data, function(resp) {
            currentOffset = parseInt(resp.petfinder.lastOffset.$t, 10);
            var pets = resp.petfinder.pets.pet;

            pets.forEach(function(pet) {
              $("#pets").append(formatPet(pet));
            });

            spinnerStop();

             // Check if we pulled the maximum amount of pets
            if(pets && (pets.length == null || pets.length === maxOffset)) {
              $btnMore.removeClass("invisible");
            }
          }).then(function() {
            $(document).foundation();
          });
        }

        /*
         * Format each pet HTML block.
         */
        function formatPet(pet) {
          var div = $("<div class='pet-box clearfix panel'></div>"),
            headerDiv = $("<div class='clearfix'></div>"),
            name = pet.name.$t,
            sex = pet.sex.$t,
            desc = pet.description.$t.trim(),
            options = pet.options.option,
            ul = $('<ul/>', {class: 'options '}),
            first = true,
            optListItem;

          $(headerDiv).append("<h2 class='pet-name'><span class='label'>"+name+"</span></h2>");

          options.forEach(function(option) {
            optListItem = optionListItem(option, sex);
            if(optListItem) {
              ul.append($('<li/>').append(optListItem));
            }
          });
          $(div).append(headerDiv.append(ul));

          if(desc.match("^<div>") && desc.match("</div>$")) {
            desc = desc.replace(/^<div>/,"<p>").replace(/<\/div>$/,"</p>");
          } else if(!desc.match("^<") && !desc.match(">$")) {
            desc = "<p>" + desc + "</p>";
          }
          desc = $("<div class='clearfix'>"+desc+"</div>");

          if(pet.media.photos && pet.media.photos.photo.length) {
            var photos = pet.media.photos.photo,
              ul = $('<ul/>', {class: 'clearing-thumbs clearing-feature', 'data-clearing': ''}),
              li, anchor, img;

            photos.forEach(function(photo) {
              if(photo['@size'] == "x") {
                li = (first) ? $('<li/>', {class: 'clearing-featured-img'}) : $('<li/>');
                first = false;
                anchor = $('<a/>', {
                  href: photo.$t,
                  class: 'th'
                });
                img = $('<img/>', {src: photo.$t}).attr('alt', name + photo['@id']);
                ul.append(li.append(anchor.append(img)));
              }
            });
            $(desc).prepend(ul);
          }
          $(div).append(desc).css({padding: "4px", margin: "3px 3px 20px 3px"});

          return div;
        }

        /**
          Start here
         */
        $(document).ready(function() {
          getPets();
          $("#btnMore").click(function() {
            getPets();
          });
        });
      })();
    </script>
  </body>
</html>

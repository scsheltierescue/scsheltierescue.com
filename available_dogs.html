<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Available Dogs</title>
    <meta name="description" content="List of SC Sheltie Rescue dogs available for adoption.">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" sizes="192x192" href="favicon-192x192.png">

    <link rel="stylesheet" href="css/app.20141229.css"> <!-- Cache Busting: Update the # when you update main.css -->
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>
  <body>
    <!--[if lte IE 8]>
    <div data-alert class="alert-box warning browsehappy-alert">
      You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.
      <a href="#" class="close">&times;</a>
    </div>
    <![endif]-->

    <div class="page-wrap">
      <div class="contain-to-grid sticky">
        <nav class="top-bar" data-topbar>
          <ul class="title-area">
            <!-- Title Area -->
            <li class="name">
              <h1 class="show-for-large-up"><a href="index.html">South Carolina Sheltie Rescue</a></h1>
              <h1 class="show-for-medium-down"><a href="index.html">SCSR</a></h1>
            </li>
            <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">
            <ul class="right">
              <li><a href="index.html">Home</a></li>
              <li class="has-dropdown"><a href="available_dogs.html">Adopt</a>
                <ul class="dropdown">
                  <li><a href="adoption_requirements.html">Adoption Requirements</a></li>
                  <li class="active"><a href="available_dogs.html">Adoptable Dogs</a></li>
                  <li><a href="apply_to_adopt.php">Adoption Application</a></li>
                  <li><a href="apply_to_foster.php">Fostering Application</a></li>
                </ul>
              </li>
              <li><a href="surrender.html">Surrender a Sheltie</a></li>
              <li><a href="help_and_advice.html">Help and Advice</a></li>
              <li><a href="events.html">Rescue Events</a></li>
            </ul>
          </section>
        </nav>
      </div>

      <div class="row">
        <div class="large-12 medium-12 small-12 columns">
          <main role="main" class="main-content">
            <h2 class="headline first">Available for Adoption</h2>
            <p>You can view our available dogs below or on our <a href="http://www.petfinder.com/pet-search?animal_type=&pet_breed=&pet_age=&pet_size=&specialNeeds=&declawedPets=&children=&status=&shelter_pet_id=&internal=&contact=&name=&shelter_id=SC92&sort=" target="_blank">Petfinder site</a>. If you are interested in adopting one of our rescue dogs, please complete and submit our <a href="apply_to_adopt.php">Adoption Application</a> form. If you have any questions feel free to <a href="mailto:amanda@southcarolinasheltierescue.com">email</a> us.</p>

            <div id="pets" class="clearfix"></div>
            <div id="spinner" class="loading_spinner"></div>

            <input id="btnMore" type="button" class="large button expand invisible" value="View More" />
          </main>
        </div>
      </div>
    </div>

    <footer class="main-footer">
      <section id="social-media" class="social-media">
        <a href="http://www.petfinder.com/pet-search?shelterid=SC92" target="_blank">
          <span class="icon-bone"></span><span class="visuallyhidden">Petfinder</span>
        </a>
        <a href="https://www.facebook.com/SouthCarolinaSheltieRescue" target="_blank">
          <span class="icon-facebook"></span><span class="visuallyhidden">Facebook</span>
        </a>
        <a href="https://twitter.com/scsheltierescue" target="_blank">
          <span class="icon-twitter"></span><span class="visuallyhidden">Twitter</span>
        </a>
      </section>
      <section id="address" class="address">
        <p class="no-margin-bottom">
          <span class="name">SC Sheltie Rescue</span><br/>
          <span class="po-box">P.O. Box 11414</span><br/>
          <span class="city-state-zip">Columbia, SC 29211</span><br/>
          <span class="tel"><a href="tel:+18039200644">803.920.0644</a></span>
        </p>
      </section>
      <section id="copyright" class="copyright">
        <small>&copy; <script>document.write(new Date().getFullYear())</script><noscript>2014</noscript> South Carolina Sheltie Rescue</small>
      </section>
    </footer>


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/handlebars/handlebars.runtime.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/templates.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script>
      var currentOffset = 0,
          spinner = undefined,
          isFirstGetPetsAPICall = true;

      /**
        Start Here
       */
      getPets();
      $("#btnMore").on('click', function() {
        isFirstGetPetsAPICall = false;
        getPets();
      });

      /**
        Call petfinder.php to get a list of available dogs.
        Next, append the data to the HTML document.
       */
      function getPets() {
        var $btnMore = $("#btnMore"),
            url = "petfinder.php",
            data = {
              offset: currentOffset
            };

        spinnerStart($btnMore);

        // Retrieve the Petfinder API pet data
        $.getJSON(url, data)
          .done(petfinderDone)
          .fail(petfinderFail)
          .always(petfinderAlways);
      }

      function petfinderDone(data, textStatus, jqXHR) {
        currentOffset = parseInt(data.petfinder.lastOffset.$t, 10);
        var pets = normalizeToArray(data.petfinder.pets.pet),
            context = { pets: [] },
            maxOffset = 25; //equals 'count' value from petfinder.php

        pets.forEach(function(pet) {
          context.pets.push(formatPet(pet));
        });

        spinnerStop();
        if(isFirstGetPetsAPICall || (pets && pets.length)) {
          $("#pets").append(Handlebars.templates['pet'](context));
        }

         // Check if we pulled the maximum amount of pets
        if(pets && (pets.length == null || pets.length === maxOffset)) {
          $("#btnMore").removeClass("invisible");
        }
      }

      function petfinderFail(jqXHR, textStatus, errorThrown) {
        spinnerStop();
        $("#pets").html(Handlebars.templates['pet-error-alert']);
      }

      function petfinderAlways() {
        $(document).foundation();
      }

      function formatPet(pet) {
        var petContext = { options: [] },
            name = pet.name.$t,
            sex = pet.sex.$t,
            desc = pet.description.$t.trim(),
            options = normalizeToArray(pet.options.option),
            isFirst = true,
            optListItem;

        options.forEach(function(option) {
          optListItem = formatOptionListItem(option, sex);
          if(optListItem) {
            petContext.options.push(optListItem);
          }
        });

        petContext.photos = [];
        if(pet.media.photos && pet.media.photos.photo.length) {
          var photos = pet.media.photos.photo;

          photos.forEach(function(photo) {
            if(photo['@size'] == "x") {
              petContext.photos.push({
                first: isFirst,
                src: photo.$t,
                alt: name + photo['@id']
              });
              isFirst = false;
            }
          });
        }

        petContext.name = name;
        petContext.sex = sex;
        petContext.desc = sanitizePetDesc(desc);

        return petContext;
      }

     function formatOptionListItem(option, sex) {
        var listchild = {};
        switch (option.$t) {
          case "altered":
            if(sex === "M") {
              listchild.text = "Neutered: ";
            } else if(sex === "F") {
              listchild.text = "Spayed: ";
            } else {
              listchild.text = "Spayed/Neutered: ";
            }
            listchild.icon = true;
            break;
          case "hasShots":
            listchild.text = "Shots Current: ";
            listchild.icon = true;
            break;
          case "housebroken":
          case "housetrained":
            listchild.text = "Housebroken: ";
            listchild.icon = true;
            break;
          case "noKids":
            listchild.text = "No Kids";
            break;
          case "noCats":
            listchild.text = "No Cats";
            break;
          case "noDogs":
            listchild.text = "No Dogs";
            break;
          default:
            listchild = null;
        };
        return listchild;
      }

      function sanitizePetDesc(desc) {
        if(desc.match("^<div>") && desc.match("</div>$")) {
          desc = desc.replace(/^<div>/,"<p>").replace(/<\/div>$/,"</p>");
        } else if(!desc.match("^<") && !desc.match(">$")) {
          desc = "<p>" + desc + "</p>";
        }
        return desc;
      }

      /**
        Normalize a petfinder response (Array/Object) property into an Array

          [{foo:1}, {bar:2}] => [{foo:1},{bar:2}]
          {foo:1}            => [{foo:1}]
          undefined          => []
      */
      function normalizeToArray(prop) {
        if(prop && $.isPlainObject(prop)) { prop = [prop]; }
        return prop || [];
      }

      function spinnerStart($btnMore) {
        var spinner_target = document.getElementById('spinner'),
            opts = {
              lines: 13, // The number of lines to draw
              length: 20, // The length of each line
              width: 10, // The line thickness
              radius: 30, // The radius of the inner circle
              corners: 1, // Corner roundness (0..1)
              rotate: 0, // The rotation offset
              direction: 1, // 1: clockwise, -1: counterclockwise
              color: '#000', // #rgb or #rrggbb or array of colors
              speed: 0.7, // Rounds per second
              trail: 25, // Afterglow percentage
              shadow: false, // Whether to render a shadow
              hwaccel: false, // Whether to use hardware acceleration
              className: 'spinner', // The CSS class to assign to the spinner
              zIndex: 2e9, // The z-index (defaults to 2000000000)
              top: 'auto', // Top position relative to parent in px
              left: 'auto' // Left position relative to parent in px
            };

        $btnMore.addClass("invisible");
        if(!spinner) {
          spinner = new Spinner(opts).spin(spinner_target);
        } else {
          $("#spinner").show()
          spinner.spin(spinner_target);
        }
      }

      function spinnerStop() {
        $("#spinner").hide();
        spinner.stop();
      }
    </script>
  </body>
</html>
